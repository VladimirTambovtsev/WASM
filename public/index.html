<!DOCTYPE html>
<html>
<head>
	<title>WASM Demo</title>
</head>
<body>
	<h1>WebAssembly Demo</h1>
</body>
<script>

	// Read string out of wasm memory
	const readMemStr = (offset, length) => {
		const strBuffer = new Uint8Array(wasm.instance.exports.memory.buffer, offset, length)
		const str = new TextDecoder().decode(strBuffer)
		console.log(str)
	}

	const imports = {
		// Decalre custom `strLog`, `numLog` C func to `console.log` 
		env: {
			numLog: console.log,
			strLog: readMemStr
		}
	}

	// Load WASM
	WebAssembly.instantiateStreaming( fetch('/program.wasm'), imports )
	.then( wasm => {
		console.log('WASM Ready.');

		// Make the wasm object accessible
		window.wasm = wasm

		// Check exported functions
		console.log('Exported functions: ', WebAssembly.Module.exports(wasm.module))

		// Check memory
		console.log('Memory: ', wasm.instance.exports.memory)

		// Get getDoubleNumber func
		wasm.instance.exports.getDoubleNumber(33)

		// Get getMessage func
		wasm.instance.exports.getMessage()

	})
</script>
</html>